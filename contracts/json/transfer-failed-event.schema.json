{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://momentum/contracts/transfer-failed-event.schema.json",
  "title": "Transfer Failed Event",
  "description": "Event emitted by the Transfer Service when the saga terminates unsuccessfully.",
  "allOf": [
    {
      "$ref": "./message-envelope.schema.json"
    },
    {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "messageType": {
          "const": "transfer.failed.event"
        },
        "payload": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "transferId": {
              "type": "string",
              "format": "uuid"
            },
            "debitWalletId": {
              "type": "string",
              "format": "uuid"
            },
            "creditWalletId": {
              "type": "string",
              "format": "uuid"
            },
            "amountMinorUnits": {
              "type": "integer",
              "minimum": 1
            },
            "currency": {
              "type": "string",
              "pattern": "^[A-Z]{3}$"
            },
            "reference": {
              "type": "string",
              "minLength": 1,
              "maxLength": 120
            },
            "description": {
              "type": "string",
              "maxLength": 500
            },
            "failureStage": {
              "type": "string",
              "enum": ["DEBIT", "CREDIT", "UNKNOWN"],
              "description": "Saga step that failed."
            },
            "failureReason": {
              "type": "string",
              "minLength": 1
            },
            "metadata": {
              "type": "object",
              "additionalProperties": {
                "type": ["string", "number", "boolean", "null"]
              }
            },
            "failedAt": {
              "type": "string",
              "format": "date-time"
            }
          },
          "required": [
            "transferId",
            "amountMinorUnits",
            "currency",
            "reference",
            "failureStage",
            "failureReason",
            "failedAt"
          ]
        }
      },
      "required": ["payload"]
    }
  ]
}
